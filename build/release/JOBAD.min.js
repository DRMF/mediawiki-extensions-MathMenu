/*
	JOBAD v3
	Minimized version
	built: Thu, 28 Mar 2013 16:02:12 +0100
*/

var JOBAD=function(){var d,c=function(a){if(!(this instanceof c))return new c(a);var b=this;this.element=a;_.isElement(this.element)&&(this.element=$(this.element));this.element instanceof jQuery||c.error("Can't create JOBADInstance: Not a DOM Element. ");var e={},f=[];this.modules={};this.modules.load=function(a,f,d){if(!b.modules.loaded(a)){if("boolean"==typeof d&&d)c.modules.available(a)||c.error("Error loading module "+a),e[a]=new c.modules.loadedModule(a,f,b);else{d=c.modules.getDependencyList(a);
if(!d)return c.console.warn("Unresolved dependencies for module '"+a+"'. "),!1;for(a=0;a<d.length;a++)b.modules.load(d[a],f,!0)}return!0}};this.modules.loaded=function(a){return e.hasOwnProperty(a)};this.modules.deactivate=function(a){b.modules.isActive(a)?c.warn("Module '"+a+"' is already deactivated. "):f.push(a)};this.modules.activate=function(a){b.modules.isActive(a)?c.warn("Module '"+a+"' is already activated. "):f=_.without(f,a)};this.modules.isActive=function(a){return-1==_.indexOf(f,a)};this.modules.iterate=
function(a){var c=[],f;for(f in e)if(e.hasOwnProperty(f)&&b.modules.isActive(f)){var d=a(e[f]);if(d)c.push(d);else break}return c};this.modules.iterateAnd=function(a){for(var c in e)if(e.hasOwnProperty(c)&&b.modules.isActive(c)&&!a(e[c]))return!1;return!0};this.Event={};this.Setup=function(){return b.Setup.enable()};this.Setup.enable=function(){var a=b.element,e;for(e in b.Event)c.Events[e].Setup.enable.call(b,a);return!0};this.Setup.disable=function(){return!1};for(var g in c.Events)if(c.Events.hasOwnProperty(g)&&
!c.isEventDisabled(g))if(b.Event[g]=c.util.bindEverything(c.Events[g].namespace,b),"function"==typeof c.Events[g].Setup.init)c.Events[g].Setup.init.call(b,b);else if("object"==typeof c.Events[g].Setup.init)for(var d in c.Events[g].Setup.init)c.Events[g].Setup.init.hasOwnProperty(d)&&(b.hasOwnProperty(d)?c.console.warn("Setup: Event '"+g+"' tried to override '"+d+"'"):b[d]=c.util.bindEverything(c.Events[g].Setup.init[d],b))};c.version="3.0.0";c.config={debug:!0,hoverdelay:1E3,cleanModuleNamespace:!1,
disabledEvents:[]};c.Events={};c.isEventDisabled=function(a){return-1!=c.config.disabledEvents.indexOf(a)};c.console=_.isUndefined(console)?{log:function(){},warn:function(){},error:function(){}}:{log:function(a){c.config.debug&&console.log(a)},warn:function(a){c.config.debug&&console.warn(a)},error:function(a){c.config.debug&&console.error(a)}};c.error=function(a){c.console.error(a);throw Error(a);};c.modules={};var n={},l={};c.modules.TEMPLATE={info:{identifier:"template",title:"Template Module",
author:"Tom Wiesing",description:"A template you may use as a starting point for writing other modules. ",version:"1.0",dependencies:[],hasCleanNamespace:!0},globalinit:function(){},init:function(){},keyPressed:function(){},leftClick:function(){},contextMenuEntries:function(){},hoverText:function(){}};c.modules.register=function(a){a=c.modules.createProperModuleObject(a);if(!a)return!1;var b=a.info.identifier;if(c.modules.available(b))return!1;n[b]=a;l[b]={};return!0};c.modules.createProperModuleObject=
function(a){if(!_.isObject(a))return!1;var b={globalinit:function(){},init:function(){}},e;for(e in b)if(b.hasOwnProperty(e)&&a.hasOwnProperty(e)){if("function"!=typeof a[e])return!1;b[e]=a[e]}if(a.hasOwnProperty("info")){var f=a.info;b.info={version:"",dependencies:[]};if(f.hasOwnProperty("version")){if("string"!=typeof f.version)return!1;b.info.version=f.version}b.info.hasCleanNamespace=f.hasOwnProperty("hasCleanNamespace")?!1==f.hasCleanNamespace?!1:!0:!0;if(f.hasOwnProperty("dependencies")){var d=
f.dependencies;if(!_.isArray(d))return!1;b.info.dependencies=d}try{_.map(["identifier","title","author","description"],function(a){if(f.hasOwnProperty(a)){var e=f[a];if("string"!=typeof e)throw"";b.info[a]=e}else throw"";})}catch(h){return!1}d=["info","globalinit","init"];b.namespace={};for(e in a)a.hasOwnProperty(e)&&(-1==d.indexOf(e)&&!c.Events.hasOwnProperty(e))&&(b.info.hasCleanNamespace?c.console.warn("Warning: Module '"+b.info.identifier+"' says its namespace is clean, but property '"+e+"' found. Check ModuleObject.info.hasCleanNamespace. "):
b.namespace[e]=a[e]);for(e in c.Events)a.hasOwnProperty(e)&&(b[e]=a[e]);return b}return!1};c.modules.available=function(a,b){b="boolean"==typeof b?b:!1;var e=n.hasOwnProperty(a);if(b&&e){for(var e=n[a].info.dependencies,f=0;f<e.length;f++)if(!c.modules.available(e[f],!0))return!1;return!0}return e};c.modules.getDependencyList=function(a){if(!c.modules.available(a,!0))return!1;var b=[a];a=n[a].info.dependencies;for(var e=a.length-1;0<=e;e--)b=_.union(b,c.modules.getDependencyList(a[e]));return b};
c.modules.loadedModule=function(a,b,e){c.modules.available(a)||c.error("Module is not available and cant be loaded. ");this.globalStore={get:function(b){return l[a][b+"_"]},set:function(b,e){l[a][b+"_"]=e},"delete":function(b){delete l[a][b+"_"]}};var f={};this.localStore={get:function(a){return f[a]},set:function(a,b){f[a]=b},"delete":function(){delete f[a]}};var d=n[a];this.info=function(){return d.info};this.getJOBAD=function(){return e};l[a].init||(l[a].init=!0,d.globalinit.apply(void 0,[]));
for(var h=[e],k=0;k<b.length;k++)h.push(b[k]);if(c.config.cleanModuleNamespace)d.info.hasCleanNamespace||c.console.warn("Warning: Module '"+a+"' may have unclean namespace, but JOBAD.config.cleanModuleNamespace is true. ");else{b=_.clone(d.namespace);for(var j in b)!c.Events.hasOwnProperty(j)&&b.hasOwnProperty(j)&&(this[j]=b[j])}for(j in c.Events)this[j]=d.hasOwnProperty(j)?d[j]:c.Events[j]["default"];d.init.apply(this,h)};c.util={};c.util.generateMenuList=function(a){if("undefined"==typeof a)return[];
var b=[],e;for(e in a)if(a.hasOwnProperty(e)){var d=a[e];"function"==typeof d?b.push([e,d]):b.push([e,c.util.generateMenuList(d)])}return b};c.util.bindEverything=function(a,b){if(_.isObject(a)&&"function"!=typeof a){var e={},d;for(d in a)e[d]=c.util.bindEverything(a[d],b);return e}return"function"==typeof a?_.bind(a,b):_.clone(a)};d=c;d.config.debug=!1;var p=[0,0];$(document).on("mousemove.JOBADListener",function(a){p=[a.pageX-$(window).scrollLeft(),a.pageY-$(window).scrollTop()]});d.UI={};d.UI.hover=
{};d.UI.hover.config={offsetX:10,offsetY:10};var q=!1,m=void 0;d.UI.hover.enable=function(a){q=!0;m=$("<div class='JOBAD JOBADHover'>").html(a).css({position:"fixed","background-color":"grey","-webkit-border-radius":5,"-moz-border-radius":5,"border-radius":5,border:"1px solid black"});m.appendTo($("body"));$(document).on("mousemove.JOBAD.UI.hover",function(){d.UI.hover.refresh()});d.UI.hover.refresh();return!0};d.UI.hover.disable=function(){if(!q)return!1;q=!1;$(document).off("mousemove.JOBAD.UI.hover");
m.remove()};d.UI.hover.refresh=function(){q&&m.css("top",Math.min(p[1]+d.UI.hover.config.offsetY,window.innerHeight-m.outerHeight(!0))).css("left",Math.min(p[0]+d.UI.hover.config.offsetX,window.innerWidth-m.outerWidth(!0)))};d.UI.ContextMenu={};d.UI.ContextMenu.config={margin:20,width:250};d.UI.ContextMenu.enable=function(a,b,e,c){if("function"!=typeof b)return d.error("JOBAD.UI.ContextMenu.enable: demandFunction is not a function"),a;"function"!=typeof e&&(e=function(){});"function"!=typeof c&&(c=
function(){});a.on("contextmenu.JOBAD.UI.ContextMenu",function(g){if(g.ctrlKey)return!0;var h=$(g.target);g=$(g.target);for(var k=!1;!(k=b(h,g))&&!a.is(this);)h=h.parent();if(!k)return!0;$(document).trigger("JOBADContextMenuUnbind");e(a);var j=d.UI.ContextMenu.buildMenuList(k,h,g).menu().css({width:d.UI.ContextMenu.config.width,position:"fixed"}).on("contextmenu",function(){return!1}).on("mousedown",function(a){a.stopPropagation()}).appendTo($("body"));j.css("top",Math.min(p[1],window.innerHeight-
j.outerHeight(!0)-d.UI.ContextMenu.config.margin)).css("left",Math.min(p[0],window.innerWidth-j.outerWidth(!0)-d.UI.ContextMenu.config.margin));$(document).on("JOBADContextMenuUnbind",function(){j.remove();c(a);$(document).unbind("mousedown.UI.ContextMenu.Unbind JOBADContextMenuUnbind")});$(document).on("mousedown.UI.ContextMenu.Unbind",function(){$(document).trigger("JOBADContextMenuUnbind")});return!1});return a};d.UI.ContextMenu.disable=function(a){a.off("contextmenu.JOBAD.UI.ContextMenu");return a};
d.UI.ContextMenu.buildMenuList=function(a,b,e){for(var c=$("<ul>"),g=0;g<a.length;g++){var h=a[g],k=$("<a href='#'>");$li=$("<li>").appendTo(c).append(k);k.text(h[0]).on("click",function(){return!1});(function(){if("function"==typeof h[1]){var a=h[1];k.on("click",function(){$(document).trigger("JOBADContextMenuUnbind");a(b,e)})}else $li.append(d.UI.ContextMenu.buildMenuList(h[1],b,e))})()}return c};d.UI.Sidebar={};d.UI.Sidebar.config={width:100};d.UI.Sidebar.wrap=function(a){a=$(a);var b=$("<div>").css({overflow:"hidden"}),
e=$("<div>").css({"float":"right",width:d.UI.Sidebar.config.width,height:1,position:"relative"}),c=$("<div>").css({width:"100%","float":"left",overflow:"hidden"});a.wrap(b);b=a.parent();b.wrap(c);c=b.parent();c.prepend(e);return a};d.UI.Sidebar.unwrap=function(a){a=$(a);a.unwrap().parent().find("div").first().remove();return a.unwrap()};d.UI.Sidebar.addNotification=function(a,b){var e=$(a),c=$(b),d=c.offset().top-e.offset().top,e=e.parent().parent().find("div").first(),h=$("<div>").css({position:"absolute",
top:d}).appendTo(e),d=function(){var a=c.offset().top-e.offset().top;h.css({top:a})};$(window).on("resize.JOBAD.UI.Sidebar",d);return h.data("JOBAD.UI.Sidebar.ResizeHook",d)};d.UI.Sidebar.forceNotificationUpdate=function(){$(window).trigger("resize.JOBAD.UI.Sidebar")};d.UI.Sidebar.removeNotification=function(a){var b=a.data("JOBAD.UI.Sidebar.ResizeHook");$(window).off("resize.JOBAD.UI.Sidebar",b);a.remove()};d.Events.leftClick={"default":function(){return!1},Setup:{enable:function(a){var b=this;a.delegate("*",
"click.JOBAD.leftClick",function(a){var d=$(a.target);switch(a.which){case 1:b.Event.leftClick.trigger(d),a.stopPropagation()}})},disable:function(a){a.undelegate("*","click.JOBAD.leftClick")}},namespace:{getResult:function(a){return this.modules.iterateAnd(function(b){b.leftClick.call(b,a,b.getJOBAD());return!0})},trigger:function(a){return this.Event.leftClick.getResult(a)}}};d.Events.contextMenuEntries={"default":function(){return[]},Setup:{enable:function(a){var b=this;d.UI.ContextMenu.enable(a,
function(a){return b.Event.contextMenuEntries.getResult(a)})},disable:function(a){d.UI.ContextMenu.disable(a)}},namespace:{getResult:function(a){for(var b=[],c=this.modules.iterate(function(b){b=b.contextMenuEntries.call(b,a,b.getJOBAD());return _.isArray(b)?b:d.util.generateMenuList(b)}),f=0;f<c.length;f++)for(var g=c[f],h=0;h<g.length;h++)b.push(g[h]);return 0==b.length?!1:b}}};d.Events.hoverText={"default":function(){return!1},Setup:{init:function(){this.Event.hoverText.activeHoverElement=void 0},
enable:function(a){var b=this;a.delegate("*","mouseenter.JOBAD.hoverText",function(d){b.Event.hoverText.trigger($(this))?d.stopPropagation():$(this).is(a)||$(this).parent().trigger("mouseenter.JOBAD.hoverText",d);return!1}).delegate("*","mouseleave.JOBAD.hoverText",function(){return b.Event.hoverText.untrigger($(this))})},disable:function(a){"undefined"!=typeof this.Event.hoverText.activeHoverElement&&me.Event.hoverText.untrigger();a.undelegate("*","mouseenter.JOBAD.hoverText").undelegate("*","mouseleave.JOBAD.hoverText")}},
namespace:{getResult:function(a){var b=!1;this.modules.iterate(function(c){var f=c.hoverText.call(c,a,c.getJOBAD());if("undefined"!=typeof f&&"boolean"==typeof b)if("string"==typeof f)b=$("<p>").text(f);else if("boolean"!=typeof f)try{b=jQuery(f)}catch(g){d.error("Module '"+c.info().identifier+"' returned invalid HOVER result. ")}else!0===f&&(b=!0);return!0});return b},trigger:function(a){if(a.data("JOBAD.hover.Active"))return!1;var b=this.Event.hoverText.getResult(a);if("boolean"==typeof b)return b;
if(this.Event.hoverText.activeHoverElement instanceof jQuery){if(this.Event.hoverText.activeHoverElement.is(a))return!0;this.Event.hoverText.untrigger(this.Event.hoverText.activeHoverElement)}this.Event.hoverText.activeHoverElement=a;a.data("JOBAD.hover.Active",!0);var c=window.setTimeout(function(){a.removeData("JOBAD.hover.timerId");d.UI.hover.enable(b.html())},d.config.hoverdelay);a.data("JOBAD.hover.timerId",c);return!0},untrigger:function(a){if("undefined"==typeof a)if(this.Event.hoverText.activeHoverElement instanceof
jQuery)a=this.Event.hoverText.activeHoverElement;else return!1;if(!a.data("JOBAD.hover.Active"))return!1;"number"==typeof a.data("JOBAD.hover.timerId")&&(window.clearTimeout(a.data("JOBAD.hover.timerId")),a.removeData("JOBAD.hover.timerId"));a.removeData("JOBAD.hover.Active");this.Event.hoverText.activeHoverElement=void 0;d.UI.hover.disable();return!a.is(this.element)?(this.Event.hoverText.trigger(a.parent()),!1):!0}}};d.Events.onUpdate={"default":function(){},Setup:{init:{Sidebar:{forceUpdate:function(){}}},
enable:function(){this.Event.onUpdate.enabled=!0},disable:function(){this.Event.onUpdate.enabled=void 0}},namespace:{getResult:function(){this.Event.onUpdate.enabled&&this.modules.iterateAnd(function(a){a.onUpdate.call(a,a.getJOBAD());return!0})},trigger:function(){this.Event.onUpdate.getResult()}}};return d}();
