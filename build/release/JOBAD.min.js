/*
	JOBAD v3
	Minimized version
	built: Wed, 03 Apr 2013 15:06:04 +0200
*/

var JOBAD=function(f){var c,d=function(a){if(!(this instanceof d))return new d(a);var b=this;this.element=a;_.isElement(this.element)&&(this.element=f(this.element));this.element instanceof f||d.error("Can't create JOBADInstance: Not a DOM Element. ");var e={},h=[];this.modules={};this.modules.load=function(a,c,h){if(!b.modules.loaded(a)){if("boolean"==typeof h&&h)d.modules.available(a)||d.error("Error loading module "+a),e[a]=new d.modules.loadedModule(a,c,b);else{h=d.modules.getDependencyList(a);
if(!h)return d.console.warn("Unresolved dependencies for module '"+a+"'. "),!1;for(a=0;a<h.length;a++)b.modules.load(h[a],c,!0)}return!0}};this.modules.loaded=function(a){return e.hasOwnProperty(a)};this.modules.deactivate=function(a){b.modules.isActive(a)?d.warn("Module '"+a+"' is already deactivated. "):h.push(a)};this.modules.activate=function(a){b.modules.isActive(a)?d.warn("Module '"+a+"' is already activated. "):h=_.without(h,a)};this.modules.isActive=function(a){return-1==_.indexOf(h,a)};this.modules.iterate=
function(a){var c=[],h;for(h in e)if(e.hasOwnProperty(h)&&b.modules.isActive(h)){var d=a(e[h]);if(d)c.push(d);else break}return c};this.modules.iterateAnd=function(a){for(var c in e)if(e.hasOwnProperty(c)&&b.modules.isActive(c)&&!a(e[c]))return!1;return!0};this.Event={};this.Setup=function(){return b.Setup.enable()};this.Setup.enable=function(){var a=b.element,e;for(e in b.Event)d.Events[e].Setup.enable.call(b,a);return!0};this.Setup.disable=function(){return!1};for(var c in d.Events)if(d.Events.hasOwnProperty(c)&&
!d.isEventDisabled(c))if(b.Event[c]=d.util.bindEverything(d.Events[c].namespace,b),"function"==typeof d.Events[c].Setup.init)d.Events[c].Setup.init.call(b,b);else if("object"==typeof d.Events[c].Setup.init)for(var g in d.Events[c].Setup.init)d.Events[c].Setup.init.hasOwnProperty(g)&&(b.hasOwnProperty(g)?d.console.warn("Setup: Event '"+c+"' tried to override '"+g+"'"):b[g]=d.util.bindEverything(d.Events[c].Setup.init[g],b))};d.version="3.0.0";d.config={debug:!0,hoverdelay:1E3,cleanModuleNamespace:!1,
disabledEvents:[]};d.Events={};d.isEventDisabled=function(a){return-1!=d.config.disabledEvents.indexOf(a)};d.console=_.isUndefined(console)?{log:function(){},warn:function(){},error:function(){}}:{log:function(a){d.config.debug&&console.log(a)},warn:function(a){d.config.debug&&console.warn(a)},error:function(a){d.config.debug&&console.error(a)}};d.error=function(a){d.console.error(a);throw Error(a);};d.modules={};var p={},m={};d.modules.TEMPLATE={info:{identifier:"template",title:"Template Module",
author:"Tom Wiesing",description:"A template you may use as a starting point for writing other modules. ",version:"1.0",dependencies:[],hasCleanNamespace:!0},globalinit:function(){},init:function(){},keyPressed:function(){},leftClick:function(){},contextMenuEntries:function(){},hoverText:function(){}};d.modules.register=function(a){a=d.modules.createProperModuleObject(a);if(!a)return!1;var b=a.info.identifier;if(d.modules.available(b))return!1;p[b]=a;m[b]={};return!0};d.modules.createProperModuleObject=
function(a){if(!_.isObject(a))return!1;var b={globalinit:function(){},init:function(){}},e;for(e in b)if(b.hasOwnProperty(e)&&a.hasOwnProperty(e)){if("function"!=typeof a[e])return!1;b[e]=a[e]}if(a.hasOwnProperty("info")){var c=a.info;b.info={version:"",dependencies:[]};if(c.hasOwnProperty("version")){if("string"!=typeof c.version)return!1;b.info.version=c.version}b.info.hasCleanNamespace=c.hasOwnProperty("hasCleanNamespace")?!1==c.hasCleanNamespace?!1:!0:!0;if(c.hasOwnProperty("dependencies")){var f=
c.dependencies;if(!_.isArray(f))return!1;b.info.dependencies=f}try{_.map(["identifier","title","author","description"],function(a){if(c.hasOwnProperty(a)){var e=c[a];if("string"!=typeof e)throw"";b.info[a]=e}else throw"";})}catch(g){return!1}f=["info","globalinit","init"];b.namespace={};for(e in a)a.hasOwnProperty(e)&&(-1==f.indexOf(e)&&!d.Events.hasOwnProperty(e))&&(b.info.hasCleanNamespace?d.console.warn("Warning: Module '"+b.info.identifier+"' says its namespace is clean, but property '"+e+"' found. Check ModuleObject.info.hasCleanNamespace. "):
b.namespace[e]=a[e]);for(e in d.Events)a.hasOwnProperty(e)&&(b[e]=a[e]);return b}return!1};d.modules.available=function(a,b){b="boolean"==typeof b?b:!1;var e=p.hasOwnProperty(a);if(b&&e){for(var e=p[a].info.dependencies,c=0;c<e.length;c++)if(!d.modules.available(e[c],!0))return!1;return!0}return e};d.modules.getDependencyList=function(a){if(!d.modules.available(a,!0))return!1;var b=[a];a=p[a].info.dependencies;for(var e=a.length-1;0<=e;e--)b=_.union(b,d.modules.getDependencyList(a[e]));return b};
d.modules.loadedModule=function(a,b,e){d.modules.available(a)||d.error("Module is not available and cant be loaded. ");this.globalStore={get:function(b){return m[a][b+"_"]},set:function(b,e){m[a][b+"_"]=e},"delete":function(b){delete m[a][b+"_"]}};var c={};this.localStore={get:function(a){return c[a]},set:function(a,b){c[a]=b},"delete":function(){delete c[a]}};var f=p[a];this.info=function(){return f.info};this.getJOBAD=function(){return e};m[a].init||(m[a].init=!0,f.globalinit.apply(void 0,[]));
for(var g=[e],k=0;k<b.length;k++)g.push(b[k]);if(d.config.cleanModuleNamespace)f.info.hasCleanNamespace||d.console.warn("Warning: Module '"+a+"' may have unclean namespace, but JOBAD.config.cleanModuleNamespace is true. ");else{b=_.clone(f.namespace);for(var j in b)!d.Events.hasOwnProperty(j)&&b.hasOwnProperty(j)&&(this[j]=b[j])}for(j in d.Events)this[j]=f.hasOwnProperty(j)?f[j]:d.Events[j]["default"];f.init.apply(this,g)};d.util={};d.util.bindEverything=function(a,b){if(_.isObject(a)&&"function"!=
typeof a){var e={},c;for(c in a)e[c]=d.util.bindEverything(a[c],b);return e}return"function"==typeof a?_.bind(a,b):_.clone(a)};c=d;c.config.debug=!1;var q=[0,0];f(document).on("mousemove.JOBADListener",function(a){q=[a.pageX-f(window).scrollLeft(),a.pageY-f(window).scrollTop()]});c.UI={};c.UI.hover={};c.UI.hover.config={offsetX:10,offsetY:10};var r=!1,n=void 0;c.UI.hover.enable=function(a){r=!0;n=f("<div class='JOBAD JOBADHover'>").html(a).css({position:"fixed","background-color":"grey","-webkit-border-radius":5,
"-moz-border-radius":5,"border-radius":5,border:"1px solid black"});n.appendTo(f("body"));f(document).on("mousemove.JOBAD.UI.hover",function(){c.UI.hover.refresh()});c.UI.hover.refresh();return!0};c.UI.hover.disable=function(){if(!r)return!1;r=!1;f(document).off("mousemove.JOBAD.UI.hover");n.remove()};c.UI.hover.refresh=function(){r&&n.css("top",Math.min(q[1]+c.UI.hover.config.offsetY,window.innerHeight-n.outerHeight(!0))).css("left",Math.min(q[0]+c.UI.hover.config.offsetX,window.innerWidth-n.outerWidth(!0)))};
c.UI.ContextMenu={};c.UI.ContextMenu.config={margin:20,width:250};c.UI.ContextMenu.enable=function(a,b,e,d){if("function"!=typeof b)return c.error("JOBAD.UI.ContextMenu.enable: demandFunction is not a function"),a;"function"!=typeof e&&(e=function(){});"function"!=typeof d&&(d=function(){});a.on("contextmenu.JOBAD.UI.ContextMenu",function(l){if(l.ctrlKey)return!0;var g=f(l.target);l=f(l.target);for(var k=!1;!(k=b(g,l))&&!a.is(this);)g=g.parent();if(!k)return!0;f(document).trigger("JOBADContextMenuUnbind");
e(a);var j=c.UI.ContextMenu.buildMenuList(k,g,l).menu().css({width:c.UI.ContextMenu.config.width,position:"fixed"}).on("contextmenu",function(){return!1}).on("mousedown",function(a){a.stopPropagation()}).appendTo(f("body"));j.css("top",Math.min(q[1],window.innerHeight-j.outerHeight(!0)-c.UI.ContextMenu.config.margin)).css("left",Math.min(q[0],window.innerWidth-j.outerWidth(!0)-c.UI.ContextMenu.config.margin));f(document).on("JOBADContextMenuUnbind",function(){j.remove();d(a);f(document).unbind("mousedown.UI.ContextMenu.Unbind JOBADContextMenuUnbind")});
f(document).on("mousedown.UI.ContextMenu.Unbind",function(){f(document).trigger("JOBADContextMenuUnbind")});return!1});return a};c.UI.ContextMenu.disable=function(a){a.off("contextmenu.JOBAD.UI.ContextMenu");return a};c.UI.ContextMenu.buildMenuList=function(a,b,e){for(var d=f("<ul>"),l=0;l<a.length;l++){var g=a[l],k=f("<a href='#'>");$li=f("<li>").appendTo(d).append(k);k.text(g[0]).on("click",function(){return!1});(function(){if("function"==typeof g[1]){var a=g[1];k.on("click",function(){f(document).trigger("JOBADContextMenuUnbind");
a(b,e)})}else $li.append(c.UI.ContextMenu.buildMenuList(g[1],b,e))})()}return d};c.UI.Sidebar={};c.UI.Sidebar.config={width:100};c.UI.Sidebar.wrap=function(a){a=f(a);var b=f("<div>").css({overflow:"hidden"}),e=f("<div>").css({"float":"right",width:c.UI.Sidebar.config.width,height:1,position:"relative"}),d=f("<div>").css({width:"100%","float":"left",overflow:"hidden"});a.wrap(b);b=a.parent();b.wrap(d);d=b.parent();d.prepend(e);a.data("JOBAD.UI.Sidebar.active",!0);return a};c.UI.Sidebar.unwrap=function(a){a=
f(a);a.unwrap().parent().find("div").first().remove();a.removeData("JOBAD.UI.Sidebar.active");return a.unwrap()};c.UI.Sidebar.addNotification=function(a,b){var e=f(a),c=f(b),d=c.offset().top-e.offset().top,e=e.parent().parent().find("div").first(),g=f("<div>").css({position:"absolute",top:d}).appendTo(e),d=function(){var a=c.offset().top-e.offset().top;g.css({top:a})};f(window).on("resize.JOBAD.UI.Sidebar",d);return g.data("JOBAD.UI.Sidebar.ResizeHook",d)};c.UI.Sidebar.forceNotificationUpdate=function(){f(window).trigger("resize.JOBAD.UI.Sidebar")};
c.UI.Sidebar.removeNotification=function(a){var b=a.data("JOBAD.UI.Sidebar.ResizeHook");f(window).off("resize.JOBAD.UI.Sidebar",b);a.remove()};c.UI.highlight=function(a){a=f(a);a.data("JOBAD.UI.highlight.orgColor")&&a.css("backgroundColor",a.data("JOBAD.UI.highlight.orgColor"));a.stop().data("JOBAD.UI.highlight.orgColor",a.css("backgroundColor")).animate({backgroundColor:"#FFFF9C"},1E3)};c.UI.unhighlight=function(a){a=f(a);a.stop().animate({backgroundColor:a.data("JOBAD.UI.highlight.orgColor")},1E3).removeData("JOBAD.UI.highlight.orgColor")};
c.Events.leftClick={"default":function(){return!1},Setup:{enable:function(a){var b=this;a.delegate("*","click.JOBAD.leftClick",function(a){var c=f(a.target);switch(a.which){case 1:b.Event.leftClick.trigger(c),a.stopPropagation()}})},disable:function(a){a.undelegate("*","click.JOBAD.leftClick")}},namespace:{getResult:function(a){return this.modules.iterateAnd(function(b){b.leftClick.call(b,a,b.getJOBAD());return!0})},trigger:function(a){return this.Event.leftClick.getResult(a)}}};c.Events.contextMenuEntries=
{"default":function(){return[]},Setup:{enable:function(a){var b=this;c.UI.ContextMenu.enable(a,function(a){return b.Event.contextMenuEntries.getResult(a)})},disable:function(a){c.UI.ContextMenu.disable(a)}},namespace:{getResult:function(a){for(var b=[],e=this.modules.iterate(function(b){b=b.contextMenuEntries.call(b,a,b.getJOBAD());return _.isArray(b)?b:c.util.generateMenuList(b)}),d=0;d<e.length;d++)for(var f=e[d],g=0;g<f.length;g++)b.push(f[g]);return 0==b.length?!1:b}}};c.util.generateMenuList=
function(a){if("undefined"==typeof a)return[];var b=[],e;for(e in a)if(a.hasOwnProperty(e)){var d=a[e];"function"==typeof d?b.push([e,d]):b.push([e,c.util.generateMenuList(d)])}return b};c.Events.hoverText={"default":function(){return!1},Setup:{init:function(){this.Event.hoverText.activeHoverElement=void 0},enable:function(a){var b=this;a.delegate("*","mouseenter.JOBAD.hoverText",function(c){b.Event.hoverText.trigger(f(this))?c.stopPropagation():f(this).is(a)||f(this).parent().trigger("mouseenter.JOBAD.hoverText",
c);return!1}).delegate("*","mouseleave.JOBAD.hoverText",function(){return b.Event.hoverText.untrigger(f(this))})},disable:function(a){"undefined"!=typeof this.Event.hoverText.activeHoverElement&&me.Event.hoverText.untrigger();a.undelegate("*","mouseenter.JOBAD.hoverText").undelegate("*","mouseleave.JOBAD.hoverText")}},namespace:{getResult:function(a){var b=!1;this.modules.iterate(function(e){var d=e.hoverText.call(e,a,e.getJOBAD());if("undefined"!=typeof d&&"boolean"==typeof b)if("string"==typeof d)b=
f("<p>").text(d);else if("boolean"!=typeof d)try{b=f(d)}catch(l){c.error("Module '"+e.info().identifier+"' returned invalid HOVER result. ")}else!0===d&&(b=!0);return!0});return b},trigger:function(a){if(a.data("JOBAD.hover.Active"))return!1;var b=this.Event.hoverText.getResult(a);if("boolean"==typeof b)return b;if(this.Event.hoverText.activeHoverElement instanceof f){if(this.Event.hoverText.activeHoverElement.is(a))return!0;this.Event.hoverText.untrigger(this.Event.hoverText.activeHoverElement)}this.Event.hoverText.activeHoverElement=
a;a.data("JOBAD.hover.Active",!0);var d=window.setTimeout(function(){a.removeData("JOBAD.hover.timerId");c.UI.hover.enable(b.html())},c.config.hoverdelay);a.data("JOBAD.hover.timerId",d);return!0},untrigger:function(a){if("undefined"==typeof a)if(this.Event.hoverText.activeHoverElement instanceof f)a=this.Event.hoverText.activeHoverElement;else return!1;if(!a.data("JOBAD.hover.Active"))return!1;"number"==typeof a.data("JOBAD.hover.timerId")&&(window.clearTimeout(a.data("JOBAD.hover.timerId")),a.removeData("JOBAD.hover.timerId"));
a.removeData("JOBAD.hover.Active");this.Event.hoverText.activeHoverElement=void 0;c.UI.hover.disable();return!a.is(this.element)?(this.Event.hoverText.trigger(a.parent()),!1):!0}}};c.Events.onSideBarUpdate={"default":function(){},Setup:{init:{Sidebar:{forceUpdate:function(){if(0==_.keys(this.Sidebar.Elements).length)this.element.data("JOBAD.UI.Sidebar.active")&&c.UI.Sidebar.unwrap(this.element);else{this.element.data("JOBAD.UI.Sidebar.active")||c.UI.Sidebar.wrap(this.element);for(var a in this.Sidebar.Elements)this.Sidebar.Elements[a].data("JOBAD.Events.Sidebar.id")||
(this.Sidebar.Elements[a]=c.UI.Sidebar.addNotification(this.element,this.Sidebar.Elements[a]))}c.UI.Sidebar.forceNotificationUpdate();this.Event.onSideBarUpdate.trigger()},registerNotification:function(a,b){a=f(a);var d=(new Date).getTime().toString();this.Sidebar.Elements[d]=a;this.Sidebar.forceUpdate();d=this.Sidebar.Elements[d].data("JOBAD.Events.Sidebar.id",d);d.data("JOBAD.Events.Sidebar.element",a);b="undefined"==typeof b?{}:b;b.hasOwnProperty("text")&&d.text(b.text);b.trace&&d.hover(function(){c.UI.highlight(a)},
function(){c.UI.unhighlight(a)});"function"==typeof b.callback&&d.click(b.callback);return d},removeNotification:function(a){if(a instanceof f){var b=a.data("JOBAD.Events.Sidebar.id");c.UI.Sidebar.removeNotification(a);delete this.Sidebar.Elements[b];this.Sidebar.forceUpdate()}else c.error("JOABD Sidebar Error: Tried to remove invalid Element. ")}}},enable:function(){this.Sidebar.Elements={};this.Event.onSideBarUpdate.enabled=!0},disable:function(){this.Event.onSideBarUpdate.enabled=void 0}},namespace:{getResult:function(){this.Event.onSideBarUpdate.enabled&&
this.modules.iterateAnd(function(a){a.onSideBarUpdate.call(a,a.getJOBAD());return!0})},trigger:function(){this.Event.onSideBarUpdate.getResult()}}};return c}(jQuery);
